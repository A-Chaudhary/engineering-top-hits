{% extends 'base.html' %}

{% block information %}
<div id="title" class="section" style="margin-top: 0px;">
    <img src="../static/images/title-img.png" class="hero-img"/>
    <p class="body-text center">By Arthi, Rachel, Abhishek, and Elaine</p>
</div>

<div class="row section" id="intro">
 <div class="col-1"></div>
 <div class="col-6 align-self-center">
    <div class="body-text">
        <div>
            Spotify is the largest platform for music streaming on the internet. 
            It's that platform that connects everyone around the globe to the hops 
            and bops of different cultures.
        </div>
        <div style="margin-top: 3%">But have you ever wondered....</div>
        <div class="main-question">Is there a trend to the hits at the top of the charts? </div>
        <div class="main-question">Is there perfect audio formula that makes  a top hit?</div>
    </div>
 </div>
 <div class="col-4">
    <img src="../static/images/spotify-img.png" class="half-img"/>
 </div>
</div>

<div class="section" id="audio-features-intro">
    <div class="row" style="margin-bottom: 2%">
        <div class="col-1"></div>
        <div class="col-11 body-text">
            <div>Let's get some background first.</div>
            <div class="main-question" style="margin-top: 0;">What are the components of audio?</div>
            <div id="action-text">Click to explore each category</div>
            <div id="go-back">< Go Back</div>
        </div>
    </div>
    <div class="container-fluid scale-down">
        <div class="grid gap-5" id="feature-grid"></div>
    </div>
    <div id="audio-info" class="container-fluid scale-down">
    </div>
</div>

{% endblock %}

{% block exploration %}
<div class="engineer-section" id="data-viz-intro">
    <div class="row">
        <div class="col-1"></div>
        <div class="col-6 body-text">
        <!-- TODO: Change this section with @Elaine's Decade Data -->
            <div class="main-question" style="margin-top: 0;">70's Disco</div>
            <div class="action-text" id="decade-description">
                The 1970s witnessed a dynamic musical scene with disco dominating dance floors, 
                rock bands delivering anthems, and singer-songwriters creating introspective classics. The era was defined 
                by experimentation and fusion, shaping the evolution of music for years to come.
            </div>
        </div>
        <div class="col-4">
            <div class="top-song">HIT SONG OF THE 70S</div>
            <iframe class="audio-embed" src="https://open.spotify.com/embed/track/1LYNuVLtV374Iy7vlHy6BO?utm_source=generator=theme=0" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
        </div>
        <!--  -->
    </div>
</div>
<div class="graph-row">
    <div class="data-parent section" style="height:1200vh">
        <div id="data-viz"></div>
    </div>
</div>

{% endblock %}

{% block interactive %}
<div class="engineer-section" id="engineer-intro">
    <div class="row" style="margin-bottom: 2%">
        <div class="col-1"></div>
        <div class="col-11 body-text">
            <div class="main-question" style="margin-top: 0;">Engineer a Song!</div>
            <div id="action-text">See how your taste in music compares to top hits on the billboard</div>
        </div>
    </div>
</div>

<div class="body">
    <script src="../static/create.js"></script>

    <div class = "wrapper">
        <div class = "deck">
            <div class = "circleElement">
                <div class = "label">INSTRUMENTALNESS</div>
                <div class="circle" id="instrumentalness">
                    <div class="tick"></div>
                </div>
            <div class = "number" id="instrumentalnessValue">0</div>
        </div>
    
        <div class = "column">
            <div class = "wrapperSmall">
    
                <div class = "circleElement">
                    <div class = "label">SPEECHINESS</div>
                    <div class="circleSmall" id="speechiness">
                        <div class="tickSmall"></div>
                    </div>
                    <div class = "number" id="speechinessValue">0</div>
                </div>
    
                <div class = "circleElement">
                    <div class = "label">ACOUSTICNESS</div>
                    <div class="circleSmall" id="acousticness">
                        <div class="tickSmall"></div>
                    </div>
                    <div class = "number" id="acousticnessValue">0</div>
                </div>
        </div>
    
        <div class = "wrapperSmall">
    
            <div class="circleElement" style = "margin-top: 90px;">
                <div class = "label" style = "margin-bottom: 90px;">LIVENESS</div>
                <input type="range" min="0" max="100" value="50" class="slider" id="liveness">
                <div class="number" id="livenessValue" style = "margin-top: 90px;">50</div>
            </div>
    
            <div class="circleElement" style = "margin-top: 90px;">
                <div class = "label" style = "margin-bottom: 90px;">DANCEABILITY</div>
                <input type="range" min="0" max="100" value="50" class="slider" id="danceability">
                <div class="number" id="danceabilityValue" style = "margin-top: 90px;">50</div>
            </div>
    
        </div>
    
        </div>
    
        <div class = "circleElement">
            <div class = "label">ENERGY</div>
            <div class="circle" id="energy">
                <div class="tick"></div>
            </div>
            <div class = "number" id="energyValue">0</div>
        </div>
    
    </div>

    <div class = "button">
        <input type = "submit" id = "button" value = "Show similar songs">
    </div>

    
    <div class = "gap"></div>
    
    <div class = "results-wrapper">
    
        <div class="timeline" id="timeline" style="display: block;">
            <div class = "dots" id = "dots"></div>
        </div>

        <div id = "songList"></div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#dots').on('click', '.dot-wrap', function() {
            event.preventDefault();

            $('.dot-wrap').removeClass('active');
            $(this).addClass('active');

            var formData = {
                instrumentalness: $('#instrumentalnessValue').text(),
                speechiness: $('#speechinessValue').text(),
                acousticness: $('#acousticnessValue').text(),
                liveness: $('#livenessValue').text(),
                danceability: $('#danceabilityValue').text(),
                energy: $('#energyValue').text(),
                decade: $(this).text()
            };

            $.ajax({
                type: 'POST',
                url: '/create', 
                data: formData,
                success: function(response) {
                    console.log(response)
                    $('#songList').empty();

                    // add timeline here
                    var decades = ["1960s", "1970s", "1980s", "1990s", "2000s", "2010s", "2020s"];
                    $('#dots').empty();

                    var decades = ["1960s", "1970s", "1980s", "1990s", "2000s", "2010s", "2020s"];
                    for (var i = 0; i < decades.length; i++) {
                        var dotHTML = '<div class="dot-wrap';
                        if (formData.decade === decades[i]) {
                            dotHTML += ' active'; // Add 'active' class if current decade matches formData.decade
                        }
                        dotHTML += '"><div class="dot"></div>' + decades[i] + '</div>';
                        $('#dots').append(dotHTML);
                    }


                    // generating and formatting song list
                    response.song_names.forEach(function(song, index) {
                    var songElement = $('<div class="song"></div>');
                    songElement.append('<div class="popularity">' + response.popularities[index] + '<div class="popularity-text">Popularity</div></div>');
                    songElement.append('<div class="embed">');
                    songElement.find('.embed').append('<img class="img" src="' + response.images[index] + '">');
                    songElement.find('.embed').append('<div class="song-artist">');
                    songElement.find('.embed .song-artist').append('<div class="song">' + song + '</div>');
                    songElement.find('.embed .song-artist').append('<div class="artist">' + response.artists[index] + '</div>');
                    songElement.find('.embed .song-artist').append('<div class="preview">');
                    songElement.find('.embed .song-artist .preview').append('<audio controls id="audio' + index + '">');
                    songElement.find('.embed .song-artist .preview audio').append('<source src="' + response.audios[index] + '" type="audio/mpeg">');
                    
                    // conditionally add the play button if audio link is not "None"
                    if (response.audios[index] !== "None") {
                        songElement.find('.embed').append('<div class="play" onclick="togglePlayPause(' + index + ')">');
                        songElement.find('.embed .play').append('<img class="img" id="playPause' + index + '" src="../static/Play.png" style="height: 30px;width:30px;">');
                    }
                    
                    songElement.append('</div>'); 
                    $('#songList').append(songElement);
                });


                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        });


        $('#button').click(function(event) {
            event.preventDefault();

            var formData = {
                instrumentalness: $('#instrumentalnessValue').text(),
                speechiness: $('#speechinessValue').text(),
                acousticness: $('#acousticnessValue').text(),
                liveness: $('#livenessValue').text(),
                danceability: $('#danceabilityValue').text(),
                energy: $('#energyValue').text(),
                decade: '1960s'
            };

            $.ajax({
                type: 'POST',
                url: '/create', 
                data: formData,
                success: function(response) {
                    console.log(response)
                    $('#songList').empty();

                    $('#dots').empty();

                    var decades = ["1960s", "1970s", "1980s", "1990s", "2000s", "2010s", "2020s"];
                    for (var i = 0; i < decades.length; i++) {
                        var dotHTML = '<div class="dot-wrap';
                        if (formData.decade === decades[i]) {
                            dotHTML += ' active'; // Add 'active' class if current decade matches formData.decade
                        }
                        dotHTML += '"><div class="dot"></div>' + decades[i] + '</div>';
                        $('#dots').append(dotHTML);
                    }
                        
                    // generating and formatting song list
                    response.song_names.forEach(function(song, index) {
                    var songElement = $('<div class="song"></div>');
                    songElement.append('<div class="popularity">' + response.popularities[index] + '<div class="popularity-text">Popularity</div></div>');
                    songElement.append('<div class="embed">');
                    songElement.find('.embed').append('<img class="img" src="' + response.images[index] + '">');
                    songElement.find('.embed').append('<div class="song-artist">');
                    songElement.find('.embed .song-artist').append('<div class="song">' + song + '</div>');
                    songElement.find('.embed .song-artist').append('<div class="artist">' + response.artists[index] + '</div>');
                    songElement.find('.embed .song-artist').append('<div class="preview">');
                    songElement.find('.embed .song-artist .preview').append('<audio controls id="audio' + index + '">');
                    songElement.find('.embed .song-artist .preview audio').append('<source src="' + response.audios[index] + '" type="audio/mpeg">');
                    
                    // conditionally add the play button if audio link is not "None"
                    if (response.audios[index] !== "None") {
                        songElement.find('.embed').append('<div class="play" onclick="togglePlayPause(' + index + ')">');
                        songElement.find('.embed .play').append('<img class="img" id="playPause' + index + '" src="../static/Play.png" style="height: 30px;width:30px;">');
                    }
                    
                    songElement.append('</div>'); 
                    $('#songList').append(songElement);
                });


                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        });
    });

</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


{% endblock %}